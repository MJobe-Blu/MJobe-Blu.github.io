<!DOCTYPE html>
<html>

<head>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<style>
    /* input 
      styles */
    #sourceString {
        height: 2.5em;
        min-width: 100%;
        max-width: 100%;
        background-color: #fff;
        border-color: #c3cad8 !important;
        color: #2c3345;
        font-size: 1em;
        border-radius: 4px;
        border: 1px solid;
        display: block;
        padding: 0 .625em;
        outline: 0;
        margin: 0;
        text-align: left;
        box-sizing: border-box;
    }
</style>

<body>
    <span id="labelText"></span>
    <input type="text" id="sourceString" class="form-textbox" value="">
    <script type="text/javascript">

        var result = {}
        function callNSFASCheck(studentId, displayName) {
            jQuery.ajax({
                url: "https://mwr.nwu.ac.za/msmigrate/migrate/othercheck?nwunumber=10600485&displayname=WERQ",
                //url: "https://mwr.nwu.ac.za/msmigrate/migrate/othercheck?nwunumber=" + studentId + "&displayname=" + displayName,
                success: function (response) {
                    console.log(response);
                    //add result.info to array [1] and return it
                    if (response.result === "YES" && response.errorcode === "Success") {
                        console.log("Pass");
                        callResidentPlacement(studentId, displayName)
                    }
                    else {
                        console.log("Fail");
                        result.valid = false;
                        result.value = "Not a valid student"
                    }
                },
                error: function (response) {
                    console.log(response);
                    result.valid = false;
                    result.value = "NSFASCheck check failed";
                }
            })
        }

        function callResidentPlacement(studentId, displayName) {
            jQuery.ajax({
                url: "https://mwr.nwu.ac.za/msmigrate/migrate/placecheck?nwunumber=10600485&displayname=WERQ",
                //url: "https://mwr.nwu.ac.za/msmigrate/migrate/placecheck?nwunumber=" + studentId + "&displayname=" + displayName,
                success: function (response) {
                    console.log(response);
                    if (response.result === "PLACED" && response.errorcode === "Success") {
                        console.log("Pass");
                        result.valid = true;
                        result.value = "Valid student and all checks passed";
                    }
                    else {
                        console.log("Fail");
                        result.valid = false;
                        result.value = "Valid student but failed Resident Placement";
                    }
                },
                error: function (response) {
                    console.log(response);
                    result.valid = false;
                    result.value = "Resident Placement check failed";
                }
            })
        }

        // function nwuWidget() {
        //     this.init = init;
        //     // initialization of the widget
        //     function init(formData) {

        //         // send data to Jotform on change input
        //     }
        // }

        // always subscribe to ready event and implement widget related code
        // inside callback function , it is the best practice while developing widgets
        JFCustomWidget.subscribe("ready", function (data) {
            var studentName = JFCustomWidget.getWidgetSetting("studentNumber");
            var displayName = JFCustomWidget.getWidgetSetting("displayName");

            console.log(studentName);
            console.log(displayName)

            callNSFASCheck(studentName, displayName);

            // var widget = new nwuWidget();
            // widget.init(data);
            console.log(result)

            //JFCustomWidget.sendSubmit(result)

            //this is the submit event to get and return the data to jotform
            JFCustomWidget.subscribe("submit", function () {
                JFCustomWidget.sendData(result);
            });

            //this is if you wish to send data to the widget from elsewhere on the form

            //JFCustomWidget.subscribe('populate', widget.fillConditionValue);

            //this is if you wish to send data to other fields on the form, here using the label of the field

            //JFCustomWidget.setFieldsValueByLabel(widget.setupFieldData);
        });

    </script>
</body>

</html>