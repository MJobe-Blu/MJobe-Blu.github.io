<!DOCTYPE html>
<html>

<head>
    <script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<style>
</style>

<body>
    <span id="labelText"></span>
    <h1>Test1</h1>
    <script type="text/javascript">


        var valid = false;
        var value;

        //determining valid is important
        function callNSFASCheck(studentId, displayName) {
            jQuery.ajax({
                url: "https://mwr.nwu.ac.za/msmigrate/migrate/othercheck?nwunumber=10600485&displayname=WERQ",
                //url: "https://mwr.nwu.ac.za/msmigrate/migrate/othercheck?nwunumber=" + studentId + "&displayname=" + displayName,
                method: "GET",
                success: function (response) {
                    console.log(response);
                    //add result.info to array [1] and return it
                    if (response.result === "YES" && response.errorcode === "Success") {
                        console.log("Pass");
                        callResidentPlacement(studentId, displayName)
                    }
                    else {
                        console.log("Fail");
                        valid = false;
                        value = "Not a valid student"
                    }
                },
                error: function (response) {
                    console.log(response);
                    valid = false;
                    value = "NSFASCheck check failed";
                }
            })
        }

        function callResidentPlacement(studentId, displayName) {
            jQuery.ajax({
                url: "https://mwr.nwu.ac.za/msmigrate/migrate/placecheck?nwunumber=10600485&displayname=WERQ",
                //url: "https://mwr.nwu.ac.za/msmigrate/migrate/placecheck?nwunumber=" + studentId + "&displayname=" + displayName,
                method: "GET",
                success: function (response) {
                    console.log(response);
                    if (response.result === "PLACED" && response.errorcode === "Success") {
                        console.log("Pass");
                        valid = true;
                        value = "Valid student and all checks passed";
                    }
                    else {
                        console.log("Fail");
                        valid = false;
                        value = "Valid student but failed Resident Placement";
                    }
                },
                error: function (response) {
                    console.log(response);
                    valid = false;
                    value = "Resident Placement check failed";
                }
            })
        }


        //subscrive to ready
        JFCustomWidget.subscribe("ready", function (msg) {
            console.log("ready message arrived from JotForm", msg);
        });

        //subscribe to submit
        JFCustomWidget.subscribe("submit", function (msg) {
            var jotFormStudentName = JFCustomWidget.getWidgetSetting("studentNumber");
            var jotFormDisplayName = JFCustomWidget.getWidgetSetting("displayName");

            console.log(jotFormStudentName)
            console.log(jotFormDisplayName)

            var data = {
                value: value,
                //if you dont send valid data or send it true for every submit
                //your widget cannot be make required
                valid: valid
            }
            console.log(data)
            JFCustomWidget.sendData(data);
        });

    </script>
</body>

</html>