<!DOCTYPE html>
<html>

<head>
    <script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<style>
</style>

<body>
    <span id="labelText"></span>
    <h1>Test1</h1>
    <script type="text/javascript">

        function callNSFASCheck(studentId, displayName) {
            jQuery.ajax({
                url: "https://mwr.nwu.ac.za/msmigrate/migrate/othercheck?nwunumber=10600485&displayname=WERQ",
                //url: "https://mwr.nwu.ac.za/msmigrate/migrate/othercheck?nwunumber=" + studentId + "&displayname=" + displayName,
                success: function (response) {
                    console.log(response);
                    //add result.info to array [1] and return it
                    if (response.result === "YES" && response.errorcode === "Success") {
                        console.log("Pass");
                        callResidentPlacement(studentId, displayName)
                    }
                    else {
                        console.log("Fail");
                        data.valid = false;
                        data.value = "Not a valid student"
                    }
                },
                error: function (response) {
                    console.log(response);
                    data.valid = false;
                    data.value = "NSFASCheck check failed";
                }
            })
        }

        function callResidentPlacement(studentId, displayName) {
            jQuery.ajax({
                url: "https://mwr.nwu.ac.za/msmigrate/migrate/placecheck?nwunumber=10600485&displayname=WERQ",
                //url: "https://mwr.nwu.ac.za/msmigrate/migrate/placecheck?nwunumber=" + studentId + "&displayname=" + displayName,
                success: function (response) {
                    console.log(response);
                    if (response.result === "PLACED" && response.errorcode === "Success") {
                        console.log("Pass");
                        data.valid = true;
                        data.value = "Valid student and all checks passed";
                    }
                    else {
                        console.log("Fail");
                        data.valid = false;
                        data.value = "Valid student but failed Resident Placement";
                    }
                },
                error: function (response) {
                    console.log(response);
                    data.valid = false;
                    data.value = "Resident Placement check failed";
                }
            })
        }

        // function nwuWidget() {
        //     this.init = init;
        //     // initialization of the widget
        //     function init(formData) {

        //         // send data to Jotform on change input
        //     }
        // }

        // always subscribe to ready event and implement widget related code
        // inside callback function , it is the best practice while developing widgets
        JFCustomWidget.subscribe("ready", function (callback) {
            var data = callback;
            console.log(data)
            var studentName = JFCustomWidget.getWidgetSetting("studentNumber");
            var displayName = JFCustomWidget.getWidgetSetting("displayName");

            console.log(studentName);
            console.log(displayName)

            callNSFASCheck(studentName, displayName);

            JFCustomWidget.sendData(data);

            // var widget = new nwuWidget();
            // widget.init(data);
            //console.log(result)

            //JFCustomWidget.sendSubmit(result)

            //this is the submit event to get and return the data to jotform
            JFCustomWidget.subscribe("submit", function () {
                
            });

            //this is if you wish to send data to the widget from elsewhere on the form

            //JFCustomWidget.subscribe('populate', widget.fillConditionValue);

            //this is if you wish to send data to other fields on the form, here using the label of the field

            //JFCustomWidget.setFieldsValueByLabel(widget.setupFieldData);
        });

    </script>
</body>

</html>